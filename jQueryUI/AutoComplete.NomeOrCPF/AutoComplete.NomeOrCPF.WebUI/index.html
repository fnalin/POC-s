<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ofícios | Listagem</title>
    <link href="Content/bootstrap.min.css" rel="stylesheet" />
    <link href="Content/themes/base/all.css" rel="stylesheet" />
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        body {
            padding: 20px 10px;
        }

        .ui-autocomplete-loading {
            background: white url("Content/img/loading.gif") right center no-repeat;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row well well-sm">
            <div class="form-horizontal form-group">

                <label class="col-md-2 control-label">Informe o Nome ou CPF:</label>
                <div class="col-md-3">
                    <input type="text" autofocus class="form-control" id="dadosText">
                </div>

            </div>
        </div>


    </div>

    <script src="Scripts/jquery-2.1.4.min.js"></script>
    <script src="Scripts/bootstrap.min.js"></script>
    <script src="Scripts/jquery-ui-1.11.4.min.js"></script>
    <script>
        var url = "http://localhost:51882/api/Pessoas/GetPessoasAsync?";
        var params = { nome: "", cpf: "" };

        $("#dadosText").on('change keydown paste input', function () {
            params.nome = params.cpf = "";
            var texto = this.value;

            if (isNaN(texto))
                params.nome = texto;
            else
                params.cpf = texto;
        });

        $("#dadosText").autocomplete({
            minLength: 3,
            source: function (request, response) {
                $.ajax({
                    url: url + $.param(params),
                    dataType: "json",
                    type: 'GET',
                    success: function (data) {
                        response($.map(data, function (item) {
                            return {
                                //value: item.Numero,
                                label: item.Nome + " " + item.CPF,
                                id: item.Id,
                                nome: item.Nome,
                                cpf: item.cpf
                            };
                        }));
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        if (XMLHttpRequest.status === 404)
                            response(null);
                        else
                            alert('status:' + XMLHttpRequest.status + ', status text: ' + XMLHttpRequest.statusText);
                    },
                });
            },


            select: function (event, ui) {
                $(this).val("");
                event.preventDefault();
            },


        });
    </script>
</body>
</html>
